openapi: 3.0.3
info:
  title: Digital Twin Simulation API
  description: API for controlling and interacting with the Gazebo/Unity digital twin simulation environment
  version: 1.0.0
  contact:
    name: Physical AI Humanoid Robotics Team
    email: dev@physical-ai-humanoid-robotics.com

servers:
  - url: http://localhost:8080
    description: Local development server for simulation environment

paths:
  /environments:
    get:
      summary: List available simulation environments
      description: Retrieve a list of all available digital twin environments
      responses:
        '200':
          description: List of available environments
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Environment'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      summary: Create a new simulation environment
      description: Create a new digital twin environment based on specified parameters
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEnvironmentRequest'
      responses:
        '201':
          description: Environment created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Environment'
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /environments/{environmentId}:
    get:
      summary: Get environment details
      description: Retrieve detailed information about a specific simulation environment
      parameters:
        - name: environmentId
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier of the environment
      responses:
        '200':
          description: Environment details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Environment'
        '404':
          description: Environment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      summary: Delete a simulation environment
      description: Remove a specific simulation environment
      parameters:
        - name: environmentId
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier of the environment
      responses:
        '204':
          description: Environment deleted successfully
        '404':
          description: Environment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /environments/{environmentId}/launch:
    post:
      summary: Launch a simulation environment
      description: Start a specific simulation environment with the humanoid robot
      parameters:
        - name: environmentId
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier of the environment
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LaunchEnvironmentRequest'
      responses:
        '200':
          description: Environment launched successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LaunchEnvironmentResponse'
        '404':
          description: Environment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /robots/{robotId}/joints:
    get:
      summary: Get robot joint states
      description: Retrieve current joint positions, velocities, and efforts for a robot
      parameters:
        - name: robotId
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier of the robot
      responses:
        '200':
          description: Current joint states
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JointStates'
        '404':
          description: Robot not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /robots/{robotId}/joints/commands:
    post:
      summary: Send joint commands to robot
      description: Send position, velocity, or effort commands to robot joints
      parameters:
        - name: robotId
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier of the robot
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JointCommands'
      responses:
        '200':
          description: Commands sent successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommandResponse'
        '404':
          description: Robot not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /robots/{robotId}/sensors:
    get:
      summary: Get robot sensor data
      description: Retrieve current sensor readings from the robot
      parameters:
        - name: robotId
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier of the robot
      responses:
        '200':
          description: Current sensor data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SensorData'
        '404':
          description: Robot not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /environments/{environmentId}/objects:
    get:
      summary: List objects in environment
      description: Retrieve a list of all objects in a specific simulation environment
      parameters:
        - name: environmentId
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier of the environment
      responses:
        '200':
          description: List of objects in the environment
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EnvironmentObject'
        '404':
          description: Environment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /environments/{environmentId}/objects/{objectId}/pose:
    put:
      summary: Set object pose in environment
      description: Update the position and orientation of an object in the environment
      parameters:
        - name: environmentId
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier of the environment
        - name: objectId
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier of the object
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Pose'
      responses:
        '200':
          description: Object pose updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommandResponse'
        '404':
          description: Environment or object not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    Environment:
      type: object
      required:
        - id
        - name
        - type
        - sdf_path
      properties:
        id:
          type: string
          description: Unique identifier for the environment
          example: "env-001-apartment-01"
        name:
          type: string
          description: Environment name
          example: "Apartment-01"
        type:
          type: string
          description: Environment type
          enum: [apartment, laboratory, outdoor, office]
          example: "apartment"
        description:
          type: string
          description: Human-readable description of the environment
          example: "Standard apartment environment with kitchen and living room"
        sdf_path:
          type: string
          description: Path to the SDF file defining the environment
          example: "/models/apartment_01/model.sdf"
        physics_properties:
          $ref: '#/components/schemas/PhysicsProperties'
        lighting_settings:
          $ref: '#/components/schemas/LightingSettings'
        object_count:
          type: integer
          description: Number of objects in the environment
          example: 42
        creation_date:
          type: string
          format: date-time
          description: Timestamp of environment creation
          example: "2025-01-15T10:30:00Z"
        version:
          type: string
          description: Version of the environment definition
          example: "1.0.0"

    CreateEnvironmentRequest:
      type: object
      required:
        - name
        - type
        - configuration
      properties:
        name:
          type: string
          description: Name for the new environment
          example: "Custom-Apartment"
        type:
          type: string
          description: Type of environment to create
          enum: [apartment, laboratory, outdoor, office]
          example: "apartment"
        configuration:
          $ref: '#/components/schemas/EnvironmentConfiguration'
        robot_model:
          type: string
          description: Robot model to include in the environment
          example: "humanoid-robot-v2"

    EnvironmentConfiguration:
      type: object
      properties:
        room_count:
          type: integer
          description: Number of rooms to generate
          example: 3
        room_types:
          type: array
          items:
            type: string
            enum: [kitchen, living_room, bedroom, bathroom, office]
          description: Types of rooms to include
          example: ["kitchen", "living_room", "bedroom"]
        furniture_density:
          type: number
          minimum: 0.0
          maximum: 1.0
          description: Density of furniture placement (0.0 to 1.0)
          example: 0.6
        object_categories:
          type: array
          items:
            type: string
          description: Categories of objects to place in the environment
          example: ["furniture", "kitchenware", "electronics"]
        semantic_labels:
          type: boolean
          description: Whether to include semantic labeling for objects
          example: true

    LaunchEnvironmentRequest:
      type: object
      properties:
        robot_pose:
          $ref: '#/components/schemas/Pose'
        simulation_speed:
          type: number
          description: Real-time factor for simulation speed (1.0 = real-time)
          example: 1.0
        enable_gui:
          type: boolean
          description: Whether to launch with GUI interface
          example: true
        physics_engine:
          type: string
          description: Physics engine to use
          enum: [bullet, ode, dart]
          example: "bullet"

    LaunchEnvironmentResponse:
      type: object
      required:
        - status
        - launch_time
        - environment_url
      properties:
        status:
          type: string
          enum: [success, failure]
          description: Status of the launch operation
          example: "success"
        launch_time:
          type: number
          description: Time taken to launch the environment in seconds
          example: 12.5
        environment_url:
          type: string
          description: URL to access the launched environment
          example: "http://localhost:8080/simulation/active"
        robot_connection:
          type: string
          description: Connection details for robot control
          example: "rosbridge_websocket://localhost:9090"

    PhysicsProperties:
      type: object
      properties:
        gravity:
          $ref: '#/components/schemas/Vector3'
        real_time_factor:
          type: number
          description: Target simulation speed relative to real time
          example: 1.0
        max_step_size:
          type: number
          format: float
          description: Maximum physics step size in seconds
          example: 0.001
        solver_iterations:
          type: integer
          description: Number of solver iterations per step
          example: 100

    LightingSettings:
      type: object
      properties:
        ambient_light:
          $ref: '#/components/schemas/Color'
        directional_light:
          $ref: '#/components/schemas/DirectionalLight'

    Color:
      type: object
      properties:
        r:
          type: number
          minimum: 0.0
          maximum: 1.0
          description: Red component
          example: 0.8
        g:
          type: number
          minimum: 0.0
          maximum: 1.0
          description: Green component
          example: 0.8
        b:
          type: number
          minimum: 0.0
          maximum: 1.0
          description: Blue component
          example: 0.8
        a:
          type: number
          minimum: 0.0
          maximum: 1.0
          description: Alpha (transparency) component
          example: 1.0

    DirectionalLight:
      type: object
      properties:
        direction:
          $ref: '#/components/schemas/Vector3'
        color:
          $ref: '#/components/schemas/Color'
        intensity:
          type: number
          description: Light intensity
          example: 1.0

    Vector3:
      type: object
      properties:
        x:
          type: number
          description: X coordinate
          example: 0.0
        y:
          type: number
          description: Y coordinate
          example: 0.0
        z:
          type: number
          description: Z coordinate
          example: -9.81

    JointStates:
      type: object
      required:
        - names
        - positions
        - velocities
        - efforts
      properties:
        names:
          type: array
          items:
            type: string
          description: Names of the joints
          example: ["hip_joint", "knee_joint", "ankle_joint"]
        positions:
          type: array
          items:
            type: number
          description: Current joint positions in radians
          example: [0.1, -0.5, 0.3]
        velocities:
          type: array
          items:
            type: number
          description: Current joint velocities in rad/s
          example: [0.0, 0.1, -0.05]
        efforts:
          type: array
          items:
            type: number
          description: Current joint efforts in Nm
          example: [1.2, 2.5, 0.8]

    JointCommands:
      type: object
      required:
        - names
        - positions
      properties:
        names:
          type: array
          items:
            type: string
          description: Names of the joints to command
          example: ["hip_joint", "knee_joint", "ankle_joint"]
        positions:
          type: array
          items:
            type: number
          description: Target joint positions in radians
          example: [0.15, -0.45, 0.35]
        velocities:
          type: array
          items:
            type: number
          description: Target joint velocities in rad/s (optional)
          example: [0.05, 0.05, 0.05]
        efforts:
          type: array
          items:
            type: number
          description: Target joint efforts in Nm (optional)
          example: [null, null, 1.0]

    SensorData:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
          description: Timestamp of the sensor data
          example: "2025-01-15T10:30:45.123Z"
        sensors:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/SensorReading'
          description: Map of sensor names to their readings

    SensorReading:
      type: object
      discriminator:
        propertyName: type
      oneOf:
        - $ref: '#/components/schemas/CameraReading'
        - $ref: '#/components/schemas/IMUReading'
        - $ref: '#/components/schemas/LidarReading'
        - $ref: '#/components/schemas/DepthCameraReading'

    CameraReading:
      allOf:
        - $ref: '#/components/schemas/SensorReading'
        - type: object
          required:
            - type
            - image_data
            - width
            - height
          properties:
            type:
              type: string
              enum: [camera]
            image_data:
              type: string
              format: byte
              description: Base64 encoded image data
            width:
              type: integer
              description: Image width in pixels
              example: 640
            height:
              type: integer
              description: Image height in pixels
              example: 480
            encoding:
              type: string
              description: Image encoding format
              example: "rgb8"

    DepthCameraReading:
      allOf:
        - $ref: '#/components/schemas/SensorReading'
        - type: object
          required:
            - type
            - depth_data
            - width
            - height
          properties:
            type:
              type: string
              enum: [depth_camera]
            depth_data:
              type: string
              format: byte
              description: Base64 encoded depth data
            width:
              type: integer
              description: Depth image width in pixels
              example: 640
            height:
              type: integer
              description: Depth image height in pixels
              example: 480
            min_range:
              type: number
              description: Minimum measurable range in meters
              example: 0.1
            max_range:
              type: number
              description: Maximum measurable range in meters
              example: 10.0

    IMUReading:
      allOf:
        - $ref: '#/components/schemas/SensorReading'
        - type: object
          required:
            - type
            - orientation
            - angular_velocity
            - linear_acceleration
          properties:
            type:
              type: string
              enum: [imu]
            orientation:
              $ref: '#/components/schemas/Quaternion'
            angular_velocity:
              $ref: '#/components/schemas/Vector3'
            linear_acceleration:
              $ref: '#/components/schemas/Vector3'
            orientation_covariance:
              type: array
              items:
                type: number
              description: Covariance matrix for orientation (9 elements)
              example: [0.01, 0, 0, 0, 0.01, 0, 0, 0, 0.01]
            angular_velocity_covariance:
              type: array
              items:
                type: number
              description: Covariance matrix for angular velocity (9 elements)
              example: [0.01, 0, 0, 0, 0.01, 0, 0, 0, 0.01]
            linear_acceleration_covariance:
              type: array
              items:
                type: number
              description: Covariance matrix for linear acceleration (9 elements)
              example: [0.01, 0, 0, 0, 0.01, 0, 0, 0, 0.01]

    LidarReading:
      allOf:
        - $ref: '#/components/schemas/SensorReading'
        - type: object
          required:
            - type
            - ranges
            - intensities
            - angle_min
            - angle_max
            - angle_increment
          properties:
            type:
              type: string
              enum: [lidar]
            ranges:
              type: array
              items:
                type: number
              description: Distance measurements in meters
              example: [1.2, 1.3, 1.4, 1.5]
            intensities:
              type: array
              items:
                type: number
              description: Intensity measurements
              example: [100, 95, 90, 85]
            angle_min:
              type: number
              description: Start angle of the scan in radians
              example: -1.57
            angle_max:
              type: number
              description: End angle of the scan in radians
              example: 1.57
            angle_increment:
              type: number
              description: Angular distance between measurements in radians
              example: 0.01
            time_increment:
              type: number
              description: Time between measurements in seconds
              example: 0.001
            scan_time:
              type: number
              description: Time between scans in seconds
              example: 0.1
            range_min:
              type: number
              description: Minimum range value in meters
              example: 0.1
            range_max:
              type: number
              description: Maximum range value in meters
              example: 30.0

    Quaternion:
      type: object
      properties:
        x:
          type: number
          description: X component
          example: 0.0
        y:
          type: number
          description: Y component
          example: 0.0
        z:
          type: number
          description: Z component
          example: 0.0
        w:
          type: number
          description: W component
          example: 1.0

    EnvironmentObject:
      type: object
      required:
        - id
        - name
        - category
        - model_path
        - pose
      properties:
        id:
          type: string
          description: Unique identifier for the object
          example: "obj-001-cup"
        name:
          type: string
          description: Object name
          example: "Coffee Cup"
        category:
          type: string
          enum: [furniture, kitchenware, electronics, household, other]
          description: Object category
          example: "kitchenware"
        model_path:
          type: string
          description: Path to the 3D model file
          example: "/models/cup/model.sdf"
        physical_properties:
          $ref: '#/components/schemas/PhysicalProperties'
        visual_properties:
          $ref: '#/components/schemas/VisualProperties'
        pose:
          $ref: '#/components/schemas/Pose'
        scale:
          type: number
          description: Scaling factor for the object
          example: 1.0
        is_static:
          type: boolean
          description: Whether the object is fixed in place
          example: true
        collision_properties:
          $ref: '#/components/schemas/CollisionProperties'
        semantic_label:
          type: string
          description: Label for perception training
          example: "cup"

    PhysicalProperties:
      type: object
      properties:
        mass:
          type: number
          description: Mass of the object in kg
          example: 0.2
        friction:
          type: number
          description: Friction coefficient
          example: 0.5
        restitution:
          type: number
          description: Coefficient of restitution (bounciness)
          example: 0.1

    VisualProperties:
      type: object
      properties:
        color:
          $ref: '#/components/schemas/Color'
        texture:
          type: string
          description: Texture file path
          example: "/materials/textures/ceramic.png"
        material:
          type: string
          description: Material name
          example: "ceramic"

    CollisionProperties:
      type: object
      properties:
        bitmask:
          type: string
          description: Collision bitmask for selective collision detection
          example: "0x0001"
        collide_without_contact:
          type: boolean
          description: Whether to detect collisions without physical contact
          example: false

    Pose:
      type: object
      required:
        - position
        - orientation
      properties:
        position:
          $ref: '#/components/schemas/Vector3'
        orientation:
          $ref: '#/components/schemas/Quaternion'

    CommandResponse:
      type: object
      required:
        - success
        - message
      properties:
        success:
          type: boolean
          description: Whether the command was successful
          example: true
        message:
          type: string
          description: Human-readable status message
          example: "Command executed successfully"
        execution_time:
          type: number
          description: Time taken to execute the command in seconds
          example: 0.002

    Error:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Error code
          example: "ENVIRONMENT_NOT_FOUND"
        message:
          type: string
          description: Human-readable error message
          example: "The specified environment does not exist"
        details:
          type: object
          description: Additional error details
          example: {"environment_id": "env-999"}